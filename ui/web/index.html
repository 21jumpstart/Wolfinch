

<!-- ######## This is a comment, visible only in the source editor  ######## -->
<!DOCTYPE script PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<script src="https://code.jquery.com/jquery-3.3.1.js"></script>
<!-- 		<script src="https://code.jquery.com/jquery-3.3.1.min.js"
			integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo"
			crossorigin="anonymous"></script> -->
<script
	src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js"
	integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1"
	crossorigin="anonymous"></script>
<script
	src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js"
	integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM"
	crossorigin="anonymous"></script>

<link rel="stylesheet" type="text/css"
	href="https://cdn.datatables.net/1.10.19/css/jquery.dataTables.min.css">

<script type="text/javascript" charset="utf8"
	src="https://cdn.datatables.net/1.10.19/js/jquery.dataTables.js"></script>
<!--  <script type="text/javascript" charset="utf8" src="https://cdn.datatables.net/1.10.19/js/jquery.dataTables.bootstrap.js"></script>
 -->


<script type="text/javascript">
	/* 
	 $(document).ready( function () {
	 $('#statsTable').DataTable();
	 } );
	 */

	function loadTradingStats() {
		console.log("load market stats")
		$.ajax({
			type : 'GET',
			url : '/api/market_stats',
			data : {
				get_param : 'value'
			},
			dataType : 'json',
			success : function(data) {
				console.log("exch:" + data.exchange_name)
				$("#exch").text(data.exchange_name)
				$("#mkt").text(data.product_id)
				$("#nbuy").text(data.num_buy_req)
				$("#nbuy_rej").text(data.num_buy_req_reject)
				$("#nsell").text(data.num_sell_req)
				$("#nsell_rej").text(data.num_sell_req_reject)
				$("#nbuy_odr").text(data.num_buy_order)
				$("#nbuy_odr_s").text(data.num_buy_order_success)
				$("#nbuy_odr_f").text(data.num_buy_order_failed)
				$("#nsell_odr").text(data.num_sell_order)
				$("#nsell_odr_s").text(data.num_sell_order_success)
				$("#nsell_odr_f").text(data.num_sell_order_failed)
				$("#sl_hits").text(data.num_stop_loss_hit)
				$("#tp_hits").text(data.num_take_profit_hit)
				$("#success_trades").text(data.num_success_trade)
				$("#failed_trades").text(data.num_failed_trade)	
				$("#buyn_hold_profit").text(data.cur_buy_and_hold_profit)	
				
				//#Fund
				$("#fund_init").text(data.fund.initial_value)
				$("#fund_curr").text(data.fund.current_value)
				$("#curr_hold").text(data.fund.current_hold_value)
				$("#fund_profit").text(data.fund.current_realized_profit)
				$("#fund_trade_fee").text(data.fund.fee_accrued)
				$("#fund_traded").text(data.fund.total_traded_value)
				$("#fund_avg_price").text(data.fund.current_avg_buy_price)
				$("#fund_last_price").text(data.fund.latest_buy_price)
				$("#fund_liq_cent").text(data.fund.fund_liquidity_percent)
				$("#fund_max_per_buy").text(data.fund.max_per_buy_fund_value)

				//#Assets
				$("#asset_init").text(data.asset.initial_size)
				$("#asset_curr").text(data.asset.current_size)
				$("#asset_traded").text(data.asset.total_traded_size)
				$("#asset_last_traded").text(data.asset.latest_traded_size)
				$("#asset_max_per_trade").text(data.asset.max_per_trade_size)
				$("#asset_hold_sz").text(data.asset.hold_size)
				$("#asset_cur_hold_sz").text(data.asset.current_hold_size)

				//#position
				/* 	            $.each(data, function(index, element) {
				 $('body').append($('<div>', {
				 text: element.name
				 }));
				 }); */
			}
		});
	}
	var table;
	$(document).ready(function() {

		console.log("load stats")
		loadTradingStats();
		setInterval(loadTradingStats, 30000);

		/* 			var dataSet = [
		 {
		"status": "closed", "open_time":"2019-05-27T16:31:20.743832", "closed_time":"2019-05-27T16:31:20.757285", "profit": 5.555600, "stop_loss": 0.000000, "take_profit":0.000000,
		"buy":{"id":"88786902-80d7-11e9-9954-8c8590ab863e", "product_id":"BTC-USD", "side":"buy", "order_type":"market",
		"status_type":"done", "status_reason":"filled", "request_size":92.592594,
		"filled_size":92.592594, "remaining_size":0.000000, "price":0.180000, "funds":16.666667,
		"fees":0.000000, "create_time":"2019-05-27T16:31:20.743832", "update_time":"None"}
		,"sell":{"id":"8879810c-80d7-11e9-be63-8c8590ab863e", "product_id":"BTC-USD", "side":"sell", "order_type":"None",
		"status_type":"done", "status_reason":"filled", "request_size":92.592594,
		"filled_size":92.592594, "remaining_size":0.000000, "price":0.240000, "funds":0.000000,
		"fees":0.000000, "create_time":"2019-05-27T16:31:20.757285", "update_time":"None"}
		}, {
		"status": "closed", "open_time":"2019-05-27T16:31:20.744187", "closed_time":"2019-05-27T16:31:20.760100",
		"profit": 0.000100, "stop_loss": 0.000000, "take_profit":0.000000,
		"buy":{"id":"88787359-80d7-11e9-ac40-8c8590ab863e", "product_id":"BTC-USD", "side":"buy", "order_type":"market",
		"status_type":"done", "status_reason":"filled", "request_size":92.592594,
		"filled_size":92.592594, "remaining_size":0.000000, "price":0.180000, "funds":16.666667,
		"fees":0.000000, "create_time":"2019-05-27T16:31:20.744187", "update_time":"None"}
		,"sell":{"id":"8879d682-80d7-11e9-a1c7-8c8590ab863e", "product_id":"BTC-USD", "side":"sell", "order_type":"None",
		"status_type":"done", "status_reason":"filled", "request_size":0.002451,
		"filled_size":0.002451, "remaining_size":0.000000, "price":0.240000, "funds":0.000000,
		"fees":0.000000, "create_time":"2019-05-27T16:31:20.760100", "update_time":"None"}
		}]
		 */

		table = $('#statsTable').DataTable({
			//data : dataSet,
			//ajax: '/api/data',
			"processing" : true,
			pageLength : 25,
			ajax : {
				url : "/api/order_data?abcd=1",
				dataSrc : ''
			},

			columns : [ {
				title : "status",
				data : "status"
			}, {
				title : "buy price",
				data : "buy.price"
			}, {
				title : "sell price",
				data : null, render: function ( data, type, row ) {
					//console.log("data:"+data)
					if (data.sell != undefined ) {
						return data.sell.price;
					} else {
						return "-";
					}
				}
			}, {
				title : "stop loss",
				data : "stop_loss"
			}, {
				title : "take profit",
				data : "take_profit"
			}, {
				title : "profit",
				data : "profit"
			}, {
				title : "type",
				data : "buy.order_type"
			}, {
				title : "request size",
				data : "buy.request_size"
			}, {
				title : "buy filled size",
				data : "buy.filled_size"
			}, {
				title : "sell filled size",
				data :  null, render: function ( data, type, row ) {
					if (data.sell != undefined ) {
						return data.sell.filled_size;
					} else {
						return "-";
					}
				}
			}, {
				title : "remaining size",
				data : "buy.remaining_size"
			}, {
				title : "funds ",
				data : "buy.funds"
			}, {
				title : "open time",
				data : "open_time"
			}, {
				title : "closed time",
				data : "closed_time"
			} ]
		});

		setInterval(function() {
			table.ajax.reload(null, false); // user paging is not reset on reload
		}, 30000);
	});
</script>
<p></p>
<div>
	<p></p>
</div>
<div>
	<p></p>
</div>
<div>
	<h1 style="color: #4485b8; text-align: center;">
		<span
			style="background-color: #4485b8; color: #ffffff; padding: 0 5px;">
			Stats</span>
	</h1>
</div>
<div>
	<table border="0" style="border-collapse: collapse; width: 100%;"
		class="display">
		<tbody style="vertical-align: top">
			<tr style="height: 60px;">
				<td style="width: 45%; height: 60px;">
					<table style="margin: false; height: 60px;" border="1" height="49">
						<tbody>
							<tr style="background-color: rgba(0, 0, 0, 0.1);">
								<td align="center" style="border: 0;" colspan="12">
									<!-- style="width: 101.272%;"  > --> <b>Trades</b>
								</td>
							</tr>
							<tr style="margin: 0; background-color: rgba(0, 0, 0, 0.1);">
								<td align="center" colspan="3" style="border: 0;">Number
									of.</td>

								<td align="center" style="border: 0;">Requests</td>
								<td align="center" style="border: 0;">Rejects</td>
								<td align="center" style="border: 0;">Orders</td>
								<td align="center" style="border: 0;">Success</td>
								<td align="center" style="border: 0;">Failed</td>
								<td align="center" style="border: 0;" colspan="2">#Hits</td>		
								<td align="center" style="border: 0;" colspan="2">#Trade Result</td>							
							</tr>
							<tr style="border-top: 0px solid #555;">
								<td
									style="border: 0px solid #555555; width: 74px; height: 24px;">Exchange</td>
								<td id="exch" style="border: 0; width: 92px; height: 24px;">0</td>

								<td style="border: 0; width: 50px;">&nbsp;Buy</td>
								<td align="center" id="nbuy" style="border: 0; width: 92px;">&nbsp;0</td>
								<td align="center" id="nbuy_rej" style="border: 0; width: 92px;">&nbsp;0</td>
								<td align="center" id="nbuy_odr" style="border: 0; width: 87px;">&nbsp;0</td>
								<td align="center" id="nbuy_odr_s"
									style="border: 0; width: 70px;">&nbsp;0</td>
								<td align="center" id="nbuy_odr_f"
									style="border: 0; width: 158px;">0</td>
								<td
									style="border: 0px solid #555555; width: 74px; height: 24px;">Stop Loss</td>
								<td align="center" id="sl_hits"
									style="border: 0; width: 58px;">0</td>		
								<td
									style="border: 0px solid #555555; width: 74px; height: 24px;">Success</td>
								<td align="center" id="success_trades"
									style="border: 0; width: 58px;">0</td>																	
							</tr>
							<tr style="background-color: rgba(0, 0, 0, 0.1);">
								<td style="border: 0; width: 74px; height: 23px;">Market</td>
								<td id="mkt" style="border: 0; width: 92px; height: 23px;">0</td>

								<td style="border: 0; width: 50px;">&nbsp;Sell</td>
								<td align="center" id="nsell" style="border: 0; width: 92px;">&nbsp;0</td>
								<td align="center" id="nsell_rej"
									style="border: 0; width: 92px;">&nbsp;0</td>
								<td align="center" id="nsell_odr"
									style="border: 0; width: 87px;">&nbsp;0</td>
								<td align="center" id="nsell_odr_s"
									style="border: 0; width: 70px;">&nbsp;0</td>
								<td align="center" id="nsell_odr_f"
									style="border: 0; width: 158px;">0</td>
								<td
									style="border: 0px solid #555555; width: 74px; height: 24px;">Take Profit</td>	
								<td align="center" id="tp_hits"
									style="border: 0; width: 58px;">0</td>	
								<td
									style="border: 0px solid #555555; width: 74px; height: 24px;">Failed</td>	
								<td align="center" id="failed_trades"
									style="border: 0; width: 58px;">0</td>																										
							</tr>
						</tbody>
					</table>
				</td>
				<td style="width: 33%;"></td>
			</tr>
			<tr style="width: 100%; height: 23px;" align="center">
				<td style="width: 75%; height: 23px; border-collapse: collapse;"
					colspan="1">
					<table id="statsTable" class="display compact"
						style="vertical-align: top; height: 100%;">
						<thead>
							<tr>
								<th style="width: 50px;">0</th>
								<th style="width: 75px;">1</th>
								<th style="width: 75px;">2</th>
								<th style="width: 75px;">3</th>
								<th style="width: 50px;">4</th>
								<th style="width: 75px;">5</th>
								<th style="width: 75px;">6</th>
								<th style="width: 70px;">7</th>
								<th style="width: 75px;">8</th>
								<th style="width: 75px;">3</th>
								<th style="width: 50px;">9</th>
								<th style="width: 75px;">10</th>
								<th style="width: 75px;">11</th>
								<th style="width: 70px;">12</th>
								<!-- <th style="width: 75px;">13</th>  -->
							</tr>
						</thead>
						<tbody></tbody>
					</table>
				</td>

				<td style="width: 35%; padding-right: 20px;">
					<div>

						<table border="0" style="border-collapse: collapse;"
							class="display">
							<tbody>
								<tr style="background-color: rgba(0, 0, 0, 0.1);">
									<td align="center" colspan="9">
										<!-- style="width: 101.272%;"  > --> <b>Funds</b>
									</td>
								</tr>
								<tr>
									<td style="width: 10%;">Inital</td>
									<td style="width: 10%;" id="fund_init">0</td>

								</tr>
								<tr>
									<td style="width: 10%;">Current</td>
									<td style="width: 10%;" id="fund_curr">0</td>

								</tr>
								<tr>
									<td style="width: 10%;">Curr. hold</td>
									<td style="width: 10%;" id="curr_hold">0</td>

								</tr>
								<tr>
									<td style="width: 10%;">Total Traded</td>
									<td style="width: 10%;" id="fund_traded">0</td>

								</tr>
								<tr>
									<td style="width: 10%;">Real. Profit</td>
									<td style="width: 10%;" id="fund_profit">0</td>

								</tr>
								<tr>
									<td style="width: 10%;">Buy n Hold Profit</td>
									<td style="width: 10%;" id="buyn_hold_profit">0</td>

								</tr>								
								<tr>
									<td style="width: 10%;">Avg. Price</td>
									<td style="width: 10%;" id="fund_avg_price"></td>

								</tr>
								<tr>
									<td style="width: 10%;">Last Price</td>
									<td style="width: 10%;" id="fund_last_price">0</td>

								</tr>
								<tr>
									<td style="width: 10%;">Fee Accrued</td>
									<td style="width: 10%;" id="fund_trade_fee">0</td>

								</tr>
								<tr>
									<td style="width: 10%;">Config. Fund Liq.(%)</td>
									<td style="width: 10%;" id="fund_liq_cent"></td>

								</tr>
								<tr>
									<td style="width: 10%;">Config. Max Per buy($)</td>
									<td style="width: 10%;" id="fund_max_per_buy">0</td>

								</tr>
								<tr>
									<td style="width: 10%;"></td>
									<td style="width: 10%;"></td>

								</tr>
								<tr>
									<td style="width: 10%;"></td>
									<td style="width: 10%;"></td>
								</tr>
							</tbody>
						</table>
					</div>

					<div>
						<table border="0"
							style="vertical-align: top; border-collapse: collapse; width: 100%;"
							class="display">
							<tbody>
								<tr style="width: 20%; background-color: rgba(0, 0, 0, 0.1);">
									<td style="width: 100;" colspan="5" align="center"><b>Assets</b></td>
								</tr>
								<tr>
									<td style="width: 10%;">Inital</td>
									<td style="width: 10%;" id="asset_init">0</td>
								</tr>

								<tr>
									<td style="width: 10%;">Current</td>
									<td style="width: 10%;" id="asset_curr">0</td>
								</tr>

								<tr>
									<td style="width: 10%;">Total Traded</td>
									<td style="width: 10%;" id="asset_traded">0</td>
								</tr>

								<tr>
									<td style="width: 10%;">Last Traded</td>
									<td style="width: 10%;" id="asset_last_traded">0</td>
								</tr>

								<tr>
									<td style="width: 10%;">Curr. Hold Size</td>
									<td style="width: 10%;" id="asset_cur_hold_sz">0</td>
								</tr>

								<tr>
									<td style="width: 10%;">Config. Hold Size</td>
									<td style="width: 10%;" id="asset_hold_sz">0</td>
								</tr>

								<tr>
									<td style="width: 10%;">Config. Max per trade</td>
									<td style="width: 10%;" id="asset_max_per_trade">0</td>
								</tr>


							</tbody>
						</table>
					</div>
				</td>
			</tr>
		</tbody>
	</table>

</div>
<div></div>
<div>
	<p></p>
</div>
<div>
	<hr />
</div>
<div>
	<div style="align: bottom">
		<p>
			<em>&copy; 2017-2019 OldMonk Bot</em>
		</p>
	</div>
</div>
</html>